---
layout:     post
title:      "小程序使用自定义字体"
subtitle:   "小程序的坑😢"
date:       2018-04-26
author:     "Jeff"
header-img: "img/post-bg-2015.jpg"
tags:
    - JavaScript
    - 小程序
---

## 小程序使用自定义字体

在小程序开发过程中，遇到了一个使用自定义字体的需求。具体如下

> 所有展现价格的数字，都要用特定字体。

当前有几个前置限制

- 小程序包有2M大小的限制
- 中文字体动辄10M+的大小，英文字体通常也有200k左右的大小
- 小程序打包是会将工程下所有文件都打入代码包内
- iconfont, 图片文件不能通过wxss引用。

受小程序大小的限制，字体是没办法放在小程序包内的。同时因为wxss的限制，我们的自定义字体需要通过线上引用，或者转base64引用。

### 线上引用

- 将字体文件上传到CDN，解决了wxss对字体文件引用的限制。
- 首次下载字体会很慢。
- 字体文件还是很大，动辄几M的流量下载是无法接受的。

### base64引用
字体转base64可以通过这个[网站](https://www.motobit.com/util/base64-decoder-encoder.asp)转。
- 字体文件转成base64，解决了wxss对字体文件引用的限制。
- base64文件打包进小程序，受到小程序包大小的限制。

综上所述，不论是**线上引用**还是转**base64**引用，字体文件都不能太大。

### 字蛛

我们这里用到的自定义字体，实际上只需要用到 **0 ~ 9** 的10个数字，**¥**，**.** 。所以我们完全可以把字体文件内的其他文字删掉，减少字体文件的大小。

**字蛛**可以把我们使用到的文字摘选出来，使用方法不在这里介绍，请直接去字蛛的文档查阅。

通过字蛛，我们把 *Rubik-Medium.ttf* 文件从**144kb**减少至**9kb**，我们可以看下我们使用的字体文件里有些什么。

![default](https://user-images.githubusercontent.com/20382725/39284277-0f83d3e4-4945-11e8-8095-046e4d6df9e8.jpeg)

可以看到，文件里只有我们需要使用到的文字。这样，9kb大小的字体不论是通过cdn引用还是转成base64都是一个可以接受的方案了。